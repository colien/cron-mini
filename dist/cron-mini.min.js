!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CronMini={})}(this,(function(t){"use strict";var e=function t(e){if(!(this instanceof t))return new t(e);this.cron=e;var o=function(t){for(var e=t.split(" "),n=/^((([0-9]{1,2}([-\/][0-9]{1,2})?)(,[0-9]{1,2}([-\/][0-9]{1,2})?)*)|[\*\?])$/,o=[],i=e.length;i<6;i++)e[i].push("*");for(var s=0;s<e.length;s++){var a=e[s];if(!n.test(a))return;if("*"!=a&&"?"!=a)if(a.indexOf(",")>-1){var u=a.split(/[\,]/g),p=[];for(i=0;i<u.length;i++)p=p.concat(r(u[i]));o.push(p)}else o.push(r(a));else o.push(r("0-60"))}return o}(this.cron);this.timeEnum=function(t){if(!t)return{};for(var e={},r=0;r<t.length;r++){var o=t[r];0==r?e.second=n(o,0,59):1==r?e.minute=n(o,0,59):2==r?e.hour=n(o,0,23):3==r?e.day=n(o,1,31):4==r?e.month=n(o,1,12):e.week=n(o,1,7)}return e}(o)};function r(t){var e=[];if(t.indexOf("-")>-1){for(var r=t.split(/[-]/g),n=parseInt(r[0]),o=Math.min(parseInt(r[1]),60),i=n;i<=o;i++)e.push(i);return e}if(t.indexOf("/")>-1){r=t.split(/[\/]/g),n=parseInt(r[0]);var s=parseInt(r[1]);for(i=n;i<=60;i+=s)e.push(i);return e}return[parseInt(t)]}function n(t,e,r){for(var n={times:[]},o=0;o<t.length;o++){var i=t[o];i>=e&&i<=r&&n.times.push(i)}return n.times.sort((function(t,e){return t-e})),n}var o={CronParser:e};var i,s=function(t,e){return t(e={exports:{}},e.exports),e.exports}((function(t){function e(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(t.exports=e=function(t){return typeof t},t.exports.default=t.exports,t.exports.__esModule=!0):(t.exports=e=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.default=t.exports,t.exports.__esModule=!0),e(r)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),a=(i=s)&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var u=function(t){return"[object Object]"==Object.prototype.toString.call(t)&&null!==t};var p=function(t){return"[object Function]"==Object.prototype.toString.call(t)};var c=function(t){return"[object Array]"==Object.prototype.toString.call(t)};var f=function(t){return"[object String]"==Object.prototype.toString.call(t)};function l(t){return"[object Number]"==Object.prototype.toString.call(t)}var h=l;function y(t){return t instanceof Date}var m=y;var v=function(t,e,r){return r=r||0,new Date(t,e,r)};var g,x,d,b,w=function(t,e){var r=new Date;if(y(t)?r=t:l(t)&&(e=t),e){var n=r.getDate()+e;r=new Date(r.setDate(n))}return{year:r.getFullYear(),week:r.getDay(),month:r.getMonth()+1,day:r.getDate(),hour:r.getHours(),minute:r.getMinutes(),second:r.getSeconds(),date:r}},T=function(){var t=(new Date).getTime();window.performance&&"function"==typeof window.performance.now&&(t+=performance.now());return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?r:3&r|8).toString(16)}))};Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length,r=Number(arguments[1])||0;for(r<0&&(r+=e);r<e;){if(r in this&&this[r]===t)return r;r++}return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=arguments[1],n=0;n<e;n++)n in this&&t.call(r,this[n],n,this)}),Array.prototype.map||(Array.prototype.map=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=new Array(e),n=arguments[1],o=0;o<e;o++)o in this&&(r[o]=t.call(n,this[o],o,this));return r}),Array.prototype.filter||(Array.prototype.filter=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=new Array,n=arguments[1],o=0;o<e;o++)o in this&&t.call(n,this[o],o,this)&&r.push(val);return r}),Array.prototype.some||(Array.prototype.some=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=arguments[1],n=0;n<e;n++)if(n in this&&t.call(r,this[n],n,this))return!0;return!1}),Array.prototype.every||(Array.prototype.every=function(t){var e=this.length;if("function"!=typeof t)throw new TypeError;for(var r=arguments[1],n=0;n<e;n++)if(n in this&&!t.call(r,this[n],n,this))return!1;return!0}),Object.keys||(Object.keys=(g=Object.prototype.hasOwnProperty,x=!{toString:null}.propertyIsEnumerable("toString"),b=(d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"]).length,function(t){if("object"!==a(t)&&"function"!=typeof t||null===t)throw new TypeError("Object.keys called on non-object");var e=[];for(var r in t)g.call(t,r)&&e.push(r);if(x)for(var n=0;n<b;n++)g.call(t,d[n])&&e.push(d[n]);return e})),Object.assign||(Object.assign=function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])}return r});var O={isObject:u,isFun:p,isArray:c,isString:f,isNumber:h,isDate:m,getDaysInYearMonth:v,getTargetDate:w,getUUId:T},j=O.getUUId;function I(t,e){if(!(this instanceof I))return new I(t);this.timeout=null,this.interval=null,this.opts=t,this.cb=e,this.id=j(),this.status=!1}I.prototype.setTimeout=function(t,e){return this.status=!0,this.timeout=setTimeout((function(){t()}),e),this.timeout},I.prototype.setInterval=function(t,e){return this.status=!0,this.interval=setInterval((function(){t()}),e),this.interval},I.prototype.clear=function(){this.clearInterval(),this.clearTimeout()},I.prototype.clearInterval=function(){clearInterval(this.interval),this.interval=null,this.interval||this.timeout||(this.status=!1)},I.prototype.clearTimeout=function(){clearTimeout(this.timeout),this.timeout=null,this.interval||this.timeout||(this.status=!1)},I.prototype.start=function(){var t=this,e=this.opts;e.timeout?e.interval?t.setTimeout((function(){t.clearTimeout(),t.setInterval((function(){t.cb()}),e.interval),e.immedi&&t.cb()}),e.timeout):t.setTimeout((function(){t.clearTimeout(),t.cb()}),e.timeout):e.interval?t.setInterval((function(){t.cb()}),e.interval):t.cb()};var A=o.CronParser,S={CustomTimer:I}.CustomTimer,D=O.isString,E=O.isObject,M=O.getDaysInYearMonth,k=O.getTargetDate,_=C;function C(t,e){if(!(this instanceof C))return new C(t);this.opts={},this.type,this.timers=[],this.cb=e,this.wake=t.wake||36e5,this.init(t)}function P(t,e,r,n){for(var o=t.times,i=parseInt((e+n)/r),s=parseInt((e+n)%r),a=0;a<o.length;a++)if(o[a]>=s&&s<r)return[o[a],i];return[o[0],i+1]}C.prototype.init=function(t){if(D(t)&&(this.type=2,this.opts=new A(t),this.opts.timeout=null,this.opts.interval=null),E(t)){var e={};t.cron?(this.type=3,e=new A(t.cron),t.timeout||(this.type=2),this.opts.interval=null):this.type=1,this.opts=Object.assign(t,e)}},C.prototype.start=function(){this.opts.real=1===this.type,this.createTimer({timeout:this.opts.timeout,interval:this.opts.interval,real:this.opts.real,immedi:this.opts.immedi,targetTime:""},1)},C.prototype.createTimer=function(t,e){var r=this,n=new S(t,(function(){r.createNextTimer(),n.status||r.cancel(n),t.real&&r.cb(t)}));this.timers.push(n),n.start()},C.prototype.createNextTimer=function(){var t=this.opts;if(1!=this.type&&t.timeEnum){var e=function(t,e){for(var r=t.timeEnum,n=r.month,o=r.week,i=r.day,s=r.hour,a=r.minute,u=r.second,p=k(),c=k(parseInt(e/36e5)),f=["second","minute","hour","day","month"],l=f.length-1;l>=0;l--){if((b=r[f[l]].times).indexOf(p[f[l]])<0)break}for(var h,y,m,v,g=!1,x=[],d=0;d<f.length;d++){var b=r[f[d]].times;if(d<l)x.push(b[0]);else{if("second"==f[d]&&(h=P(u,p.second,60,1),x.push(h[0])),"minute"==f[d]&&(y=P(a,p.minute,60,h?h[1]:1),x.push(y[0])),"hour"==f[d]&&(m=P(s,p.hour,24,y?y[1]:1),x.push(m[0])),"day"==f[d]){var w=M(p.year,p.month).getDate(),T=P(i,p.day,w+1,m?m[1]:1);x.push(T[0])}"month"==f[d]&&(v=P(n,p.month,13,T?T[1]:1),x.push(v[0]))}}var O=new Date(p.year+(v?v[1]:1),x[4]-1,x[3],x[2],x[1],x[0]),j=O.getTime()<=c.date.getTime();o.times.indexOf(O.getDay()||7)>-1&&j&&(e=O.getTime()-p.date.getTime(),g=!0);return{timeLen:e,real:g,targetTime:O}}(t,this.wake),r={timeout:e.timeLen,interval:0,real:e.real,targetTime:e.targetTime};this.createTimer(r,2)}},C.prototype.stop=C.prototype.clearAll=function(){if(this.timers&&this.timers.length)for(var t=this.timers.length-1;t>=0;t--){var e=this.timers[t];this.cancel(e)}this.timers=[]},C.prototype.cancel=function(t,e){if(t)for(var r=this.timers,n=0;n<r.length;n++)r[n].id===t.id&&(r.splice(n,1)[0].clear(),t&&t.clear());e&&e()};var N={CronActuator:_};t.CronActuator=_,t.default=N,Object.defineProperty(t,"__esModule",{value:!0})}));
